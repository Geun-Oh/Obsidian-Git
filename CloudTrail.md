
> [!info] AWS 계정 전반에 관한 감사를 진행하는 CCTV

- AWS 게정의 거버넌스, 감사 및 규정 준수를 돕는다
- 기본적으로 활성화
- 콘솔, SDK, CLI, 기타 AWS 서비스에서 발생한 AWS 계정 내의 모든 이벤트 및 API 호출기록 확인 가능 => 계정 관련 모든 로그 기록
- CloudTrail의 로그를 CloudWatch Logs나 S3로 옮길 수 있다.
- 전체 또는 단일 리전에 적용되는 트레일을 설정해 모든 리전에 걸친 이벤트 기록을 한 곳으로 모을 수 있다. => S3 버킷에 저장 가능
- 누군가가 AWS 에서 무언가 삭제했을 대 확인 가능
	- API호출이 남아 있다.


## CloudTrail Diagram

- 모든 이벤트를 90일 이상 보존하려면 S3 나 CloudWatch Logs로 보내면 된다.


## CloudTrail Events


### 관리 이벤트

- 리소스에서 수행되는 작업을 나타낸다
	- 누군가가 보안 설정을 구성하면 IAM AttachPolicy라는 API를 사용하며 이것이 CloudTrail에 남는다.
	- 서브넷을 생성해도 표시되고 로깅을 설정해도 기본으로 표시된다.

- 리소스나 AWS 계정을 수정하는 모든 작업이 CloudTrail에 표시
- Read Event와 Write Event를 분리 가능
	- 리소스를 수정하는 이벤트와 수정하지 않는 이벤트 => 수정하는 이벤트(write 이벤트가 중요)


### 데이터 이벤트


- 고볼륨 작업으로 기본 옵션으로 설정되지는 않는다.
- S3 버킷에 GetObject, DeleteObject, PutObject 등은 많이 수행되는 작업이므로 기본적으론 로깅되지 않는다.
	- 읽기 이벤트와 쓰기 이벤트 분리 가능

- 람다 함수 실행 작업 => 누군가 invoke 할 때 마다 Lambda 함수가 몇 번 활용되었는지 알 수 있다.
	- 람다 함수가 많이 실행되면 볼륨이 커질 수 있다.



## CloudTrail Insights


- 계정마다 많은 이벤트와 API 호출이 이루어지기 때문에 무엇이 이상하거나 특이한지 파악하기 어렵다 => 이럴 때 CloudTrail Insights 사용
- 이벤트 분석해 계정 내의 특이한 활동을 탐지한다.
- 특이한 활동
	- 부정확한 리소스 프로비저닝
	- AWS IAM 작업 버스트
	- 주기적 유지 관리 작업 부재
- 관리활동을 분석해 자체적으로 기준선을 생성한 뒤 무언가를 변경하거나 변경하려고 시도하는 모든 것을 지속적으로 분석해서 특이한 패턴을 감지한다.
- 특이한 활동을 감지한다면 Insights Event로 생성
- S3, CloudTrail console등으로 저장 가능